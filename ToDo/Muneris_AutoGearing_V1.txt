@name Muneris AutoGearing and Clutch V1
@inputs W Rpm S Space ChangeUp ChangeDown
@outputs Throttle Gear ClutchOut ClutchPercent
@persist A B Clutch EngineMax EngineMin EngineRedLine Gears AutoReactionUp AutoReactionDown AutoClutch ClutchSensitivity AutoGearing ChangeUp IdleRpm
@trigger 
runOnTick(1)
if(first()|duped()){
ClutchOut = 1
########################
AutoGearing = 1 #0 to disable the automatic gearbox, clutch will still depend on your settings.
Gears = 8
EngineMax = 3300 #Powerband Max 
EngineMin = 1100 #Powerband Min
EngineRedLine = 10000 #Not used, yet.
AutoReactionUp = 2 #Higher number = faster changes. Lower if its not changing correctly
AutoReactionDown = 0.5 #Higher number means faster downchanges. Lower if its not changing correctly
AutoClutch = 2 #2=Fully auto clutch 1=Semi Auto 0=Manual
ClutchSensitivity = 1 #Higher number means clutch is more sensitive, but you may waste power.
IdleRpm = 1500 #If you want the engine to idle at a certain rpm, specify it here
########################
}
if(tickClk()){
if(AutoClutch == 2){
    if((W==1 | S==1)){
    if(Rpm < IdleRpm){ClutchPercent=1}
    ClutchPercent = ((EngineMin / Rpm) -0.7)*ClutchSensitivity+Space
}
}
if(W==1){
    if(Gear == Gears){Gear = 1}
    Throttle = 100   
}
if((W==0 & S==0)){
    if((Rpm < IdleRpm) & IdleRpm > 0){
     Throttle = 100
     ClutchPercent = 1   
}else{Throttle = 0}
    
}
if(S==1){
    Gear=Gears
    Throttle=100   
}
if(AutoGearing){
if(Rpm>EngineMax & Space == 0){
    A=A+AutoReactionUp
}
if((A>50 | (ChangeUp & ~ChangeUp)) & Space==0){
    ClutchOut = 1
        if(Gear < (Gears-1)){
            Gear = Gear + 1
        }
    A = 0
    B = 0
}

if(Rpm < EngineMin & W>=1){
    B = B + AutoReactionDown
}
if(B > 40 | (ChangeDown & ~ChangeDown)){
    if(Gear > 1){
        ClutchOut = 1
        Gear = Gear - 1   
    }
    A = 0
    B = 0
}
if(Gear == Gears & S ==0){
    Gear = 1   
}
}else{

if((~ChangeUp & ChangeUp)){
 Gear = Gear + 1   
}

}



if(AutoClutch == 1){
    if(ClutchOut > 0 & Space==0){
        ClutchOut = (ClutchOut - 0.003)
        ClutchPercent = ClutchOut
    }
else{if(Space){ClutchOut = 1}}
}
if(Space==1){
 ClutchOut = 1   
}
}
